{% extends "base.html" %} {% block content %}
<!-- Hero Section -->
<div class="hero-section">
  <div class="container">
    <h1 class="hero-title">
      <i class="fas fa-shield-alt"></i>
      PhishingScanner
    </h1>
    <p class="hero-subtitle">
      üõ°Ô∏è Free Open Source Security Tool for Phishing Detection
    </p>
  </div>
</div>

<!-- Main Scanner Section -->
<div class="main-container">
  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="scan-card card">
        <div class="card-body p-4">
          <div class="text-center mb-4">
            <h2 class="card-title">
              <i class="fas fa-search text-primary"></i>
              URL Security Scanner
            </h2>
            <p class="text-muted">
              Enter a URL to analyze for phishing indicators and security
              threats
            </p>
          </div>

          <!-- Single URL Scanner -->
          <div class="mb-4">
            <div class="input-group input-group-lg">
              <span class="input-group-text">
                <i class="fas fa-link"></i>
              </span>
              <input
                type="url"
                id="urlInput"
                class="form-control"
                placeholder="Enter URL to scan (e.g., https://example.com)"
                required
              />
              <button class="btn btn-gradient" id="scanBtn" onclick="scanURL()">
                <i class="fas fa-shield-alt"></i> Scan URL
              </button>
            </div>
            <div class="form-text">
              <i class="fas fa-info-circle"></i>
              Supports HTTP and HTTPS URLs. Analysis includes SSL, content, and
              reputation checks.
            </div>
          </div>

          <!-- Batch Scanner -->
          <div class="mb-4">
            <button
              class="btn btn-outline-secondary"
              data-bs-toggle="collapse"
              data-bs-target="#batchScanner"
            >
              <i class="fas fa-list"></i> Batch Scan Multiple URLs
            </button>
          </div>

          <div class="collapse" id="batchScanner">
            <div class="card bg-light">
              <div class="card-body">
                <h5><i class="fas fa-layer-group"></i> Batch URL Scanner</h5>
                <p class="text-muted">
                  Enter multiple URLs (one per line, max 50)
                </p>
                <textarea
                  id="batchUrls"
                  class="form-control mb-3"
                  rows="5"
                  placeholder="https://example1.com&#10;https://example2.com&#10;https://example3.com"
                ></textarea>
                <button class="btn btn-gradient" onclick="batchScan()">
                  <i class="fas fa-tasks"></i> Batch Scan
                </button>
              </div>
            </div>
          </div>

          <!-- Loading Spinner -->
          <div class="loading-spinner text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Scanning...</span>
            </div>
            <p class="mt-2">Analyzing URL for security threats...</p>
          </div>

          <!-- Results Container -->
          <div class="result-container">
            <div id="scanResults"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Features Section -->
<div class="container mt-5">
  <div class="row">
    <div class="col-12 text-center text-white mb-4">
      <h2><i class="fas fa-star"></i> Security Features</h2>
      <p>Comprehensive phishing detection using multiple analysis techniques</p>
    </div>

    <div class="col-md-4">
      <div class="feature-card text-center">
        <i class="fas fa-globe fa-3x text-primary mb-3"></i>
        <h4>URL Analysis</h4>
        <p>
          Deep analysis of URL structure, domain reputation, and suspicious
          patterns
        </p>
      </div>
    </div>

    <div class="col-md-4">
      <div class="feature-card text-center">
        <i class="fas fa-lock fa-3x text-success mb-3"></i>
        <h4>SSL/TLS Verification</h4>
        <p>
          Certificate validation, expiration checks, and encryption analysis
        </p>
      </div>
    </div>

    <div class="col-md-4">
      <div class="feature-card text-center">
        <i class="fas fa-code fa-3x text-warning mb-3"></i>
        <h4>Content Analysis</h4>
        <p>
          HTML/JavaScript inspection for malicious patterns and phishing
          indicators
        </p>
      </div>
    </div>

    <div class="col-md-4">
      <div class="feature-card text-center">
        <i class="fas fa-server fa-3x text-info mb-3"></i>
        <h4>DNS & Network</h4>
        <p>
          DNS record validation, IP geolocation, and hosting provider analysis
        </p>
      </div>
    </div>

    <div class="col-md-4">
      <div class="feature-card text-center">
        <i class="fas fa-chart-line fa-3x text-danger mb-3"></i>
        <h4>Risk Scoring</h4>
        <p>
          Intelligent risk assessment with detailed threat level classification
        </p>
      </div>
    </div>

    <div class="col-md-4">
      <div class="feature-card text-center">
        <i class="fas fa-download fa-3x text-secondary mb-3"></i>
        <h4>Export Reports</h4>
        <p>Detailed reports in JSON and CSV formats for further analysis</p>
      </div>
    </div>
  </div>
</div>

<!-- Recent Scans -->
<div class="main-container mt-4">
  <div class="row">
    <div class="col-12">
      <h3><i class="fas fa-history"></i> Recent Scans</h3>
      <div id="recentScans">
        <p class="text-muted">
          No recent scans. Start by scanning a URL above.
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  function getRiskBadgeClass(riskScore) {
    if (riskScore >= 80) return 'risk-critical text-white'
    if (riskScore >= 60) return 'risk-high text-white'
    if (riskScore >= 40) return 'risk-medium text-dark'
    if (riskScore >= 20) return 'risk-low text-white'
    return 'risk-safe text-white'
  }

  function getRiskLabel(riskScore) {
    if (riskScore >= 80) return 'CRITICAL'
    if (riskScore >= 60) return 'HIGH'
    if (riskScore >= 40) return 'MEDIUM'
    if (riskScore >= 20) return 'LOW'
    return 'SAFE'
  }

  function showLoading() {
    document.querySelector('.loading-spinner').style.display = 'block'
    document.querySelector('.result-container').style.display = 'none'
  }

  function hideLoading() {
    document.querySelector('.loading-spinner').style.display = 'none'
    document.querySelector('.result-container').style.display = 'block'
  }

  function displayResult(result) {
    const resultsDiv = document.getElementById('scanResults')
    const riskClass = getRiskBadgeClass(result.risk_score)
    const riskLabel = getRiskLabel(result.risk_score)

    let indicatorsHtml = ''
    if (result.indicators && result.indicators.length > 0) {
      indicatorsHtml = `
            <div class="mt-3">
                <h6><i class="fas fa-exclamation-triangle text-warning"></i> Security Indicators:</h6>
                ${result.indicators
                  .map(
                    (indicator) =>
                      `<div class="indicator-item">${indicator}</div>`
                  )
                  .join('')}
            </div>
        `
    }

    const statusIcon = result.is_phishing
      ? '<i class="fas fa-exclamation-triangle text-danger"></i>'
      : '<i class="fas fa-check-circle text-success"></i>'

    const statusText = result.is_phishing
      ? '<span class="text-danger fw-bold">POTENTIAL PHISHING DETECTED</span>'
      : '<span class="text-success fw-bold">APPEARS SAFE</span>'

    resultsDiv.innerHTML = `
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h5 class="card-title">
                            <i class="fas fa-globe text-primary"></i>
                            Scan Results
                        </h5>
                        <p class="mb-2"><strong>URL:</strong> ${result.url}</p>
                        <p class="mb-2"><strong>Status:</strong> ${statusIcon} ${statusText}</p>
                        <p class="mb-2"><strong>Response Time:</strong> ${
                          result.response_time
                        }s</p>
                        <p class="mb-2"><strong>Scan Time:</strong> ${new Date(
                          result.timestamp
                        ).toLocaleString()}</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="risk-badge ${riskClass} d-inline-block">
                            <i class="fas fa-shield-alt"></i><br>
                            ${riskLabel}<br>
                            <strong>${result.risk_score}/100</strong>
                        </div>
                    </div>
                </div>
                ${indicatorsHtml}
                
                <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm" onclick="toggleDetails(this)">
                        <i class="fas fa-info-circle"></i> Show Details
                    </button>
                </div>
                
                <div class="details-section" style="display: none;">
                    <hr>
                    <h6><i class="fas fa-microscope"></i> Technical Details:</h6>
                    <pre class="bg-light p-3 rounded"><code>${JSON.stringify(
                      result.details,
                      null,
                      2
                    )}</code></pre>
                </div>
            </div>
        </div>
    `

    hideLoading()
  }

  function displayBatchResults(results) {
    const resultsDiv = document.getElementById('scanResults')

    let totalPhishing = 0
    let resultRows = ''

    results.forEach((result, index) => {
      if (result.is_phishing) totalPhishing++
      const riskClass = getRiskBadgeClass(result.risk_score)
      const riskLabel = getRiskLabel(result.risk_score)
      const statusIcon = result.is_phishing
        ? '<i class="fas fa-exclamation-triangle text-danger"></i>'
        : '<i class="fas fa-check-circle text-success"></i>'

      resultRows += `
            <tr>
                <td>${index + 1}</td>
                <td><a href="${result.url}" target="_blank">${
        result.url
      }</a></td>
                <td class="text-center">
                    <span class="badge ${riskClass}">${riskLabel} (${
        result.risk_score
      })</span>
                </td>
                <td class="text-center">${statusIcon}</td>
                <td>${result.response_time || 'N/A'}s</td>
            </tr>
        `
    })

    resultsDiv.innerHTML = `
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-tasks text-primary"></i>
                    Batch Scan Results
                </h5>
                
                <div class="row mb-3">
                    <div class="col-md-3 text-center">
                        <div class="bg-primary text-white p-3 rounded">
                            <h4>${results.length}</h4>
                            <small>Total Scanned</small>
                        </div>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="bg-danger text-white p-3 rounded">
                            <h4>${totalPhishing}</h4>
                            <small>Phishing Detected</small>
                        </div>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="bg-success text-white p-3 rounded">
                            <h4>${results.length - totalPhishing}</h4>
                            <small>Appear Safe</small>
                        </div>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="bg-info text-white p-3 rounded">
                            <h4>${Math.round(
                              results.reduce(
                                (sum, r) => sum + r.risk_score,
                                0
                              ) / results.length
                            )}</h4>
                            <small>Avg Risk Score</small>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>URL</th>
                                <th class="text-center">Risk Level</th>
                                <th class="text-center">Status</th>
                                <th>Response Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${resultRows}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `

    hideLoading()
  }

  function toggleDetails(button) {
    const detailsSection = button
      .closest('.card-body')
      .querySelector('.details-section')
    if (detailsSection.style.display === 'none') {
      detailsSection.style.display = 'block'
      button.innerHTML = '<i class="fas fa-eye-slash"></i> Hide Details'
    } else {
      detailsSection.style.display = 'none'
      button.innerHTML = '<i class="fas fa-info-circle"></i> Show Details'
    }
  }

  function scanURL() {
    const url = document.getElementById('urlInput').value.trim()
    if (!url) {
      alert('Please enter a URL to scan')
      return
    }

    showLoading()

    fetch('/api/scan', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ url: url }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.error) {
          throw new Error(data.error)
        }
        displayResult(data)
        loadRecentScans()
      })
      .catch((error) => {
        hideLoading()
        alert('Error: ' + error.message)
      })
  }

  function batchScan() {
    const urlsText = document.getElementById('batchUrls').value.trim()
    if (!urlsText) {
      alert('Please enter URLs to scan')
      return
    }

    const urls = urlsText.split('\n').filter((url) => url.trim())
    if (urls.length === 0) {
      alert('No valid URLs found')
      return
    }

    if (urls.length > 50) {
      alert('Maximum 50 URLs allowed per batch')
      return
    }

    showLoading()

    fetch('/api/batch-scan', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ urls: urls }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.error) {
          throw new Error(data.error)
        }
        displayBatchResults(data.results)
        loadRecentScans()
      })
      .catch((error) => {
        hideLoading()
        alert('Error: ' + error.message)
      })
  }

  function loadRecentScans() {
    fetch('/api/history')
      .then((response) => response.json())
      .then((data) => {
        const recentScansDiv = document.getElementById('recentScans')
        if (data.length === 0) {
          recentScansDiv.innerHTML =
            '<p class="text-muted">No recent scans. Start by scanning a URL above.</p>'
          return
        }

        let html =
          '<div class="table-responsive"><table class="table table-sm"><thead><tr><th>URL</th><th>Risk</th><th>Status</th><th>Time</th></tr></thead><tbody>'

        data
          .reverse()
          .slice(0, 5)
          .forEach((scan) => {
            const riskClass = getRiskBadgeClass(scan.risk_score)
            const statusIcon = scan.is_phishing
              ? '<i class="fas fa-exclamation-triangle text-danger"></i>'
              : '<i class="fas fa-check-circle text-success"></i>'

            html += `
                <tr>
                    <td><a href="${scan.url}" target="_blank">${
              scan.url.length > 50
                ? scan.url.substring(0, 50) + '...'
                : scan.url
            }</a></td>
                    <td><span class="badge ${riskClass}">${
              scan.risk_score
            }</span></td>
                    <td>${statusIcon}</td>
                    <td>${new Date(scan.timestamp).toLocaleString()}</td>
                </tr>
            `
          })

        html += '</tbody></table></div>'
        recentScansDiv.innerHTML = html
      })
      .catch((error) => {
        console.error('Error loading recent scans:', error)
      })
  }

  // Load recent scans on page load
  document.addEventListener('DOMContentLoaded', function () {
    loadRecentScans()

    // Allow Enter key to trigger scan
    document
      .getElementById('urlInput')
      .addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          scanURL()
        }
      })
  })
</script>
{% endblock %}
